# 国家運営シミュレーションゲーム

## ゲームロジック詳細設計書

---

## 1. 用語定義

本章では、本ゲームに登場する主要概念を**ゲーム内での意味**として定義する。データ構造や詳細仕様は後述章に記載する。

### 1.1 国家（Nation）

* プレイヤーおよびNPCが操作する運営主体
* 国力、ユニット、ステートなどを保持する

### 1.2 国力（Power）

* 国家のリソース量を現す基礎数値
* 内政・戦闘・ステート効果によって増減する
* 数値上限：**1,000,000,000（10億）**

### 1.3 ユニット（Unit）

* 国家に所属する戦力単位
* 戦闘時に前線・中衛・後衛・ベンチのいずれかに配置される
* 各ユニットは個別のステータスとスキル・ステートを持つ

### 1.4 ステート（State）

* 国家またはユニットに付与される持続効果
* 内政・戦闘・行動回数・数値計算などに影響を与える

### 1.5 スキル（Skill）

* ユニットが戦闘時に使う攻撃行動の詳細
* 攻撃対象、攻撃倍率などが設定されている

### 1.6 コマンド（Command）

* プレイヤーが内政フェーズで選択的に実行する行動
* 国力消費を伴う場合が多い

### 1.7 ステージ（Stage）

* 初期状態やゲーム設定を決める情報
* メタ情報のためゲーム中は参照されない

---

## 2. 数値ルール共通仕様

### 2.1 数値の丸め規則

* 小数が発生した場合は **常に切り上げ（ceil）** を行う

### 2.2 数値上限・下限

* 国力・HP・攻撃力などの主要数値

  * 最小値：0
  * 最大値：1,000,000,000
* 上限を超える加算が発生した場合は上限で丸める

---

## 3. データ構造定義（概要）

※詳細なJSON/YAML構造は別資料に切り出す想定

### 3.1 ステージデータ

* ステージID
* プレイヤー国家の初期状態のデータ
* NPC国家の初期状態のデータの配列
* 決着ターン数

### 3.2 国家データ

* 手番（国家ID）
* 国名
* プレイヤー操作かNPCか
* 国力
* ステート配列（付与順を保持）
* ユニット配列（ポジションを保持）
* コマンド配列

### 3.3 ユニットデータ

* ユニットID
* 所属国家ID
* ユニット名
* 最大HP
* 現在HP
* 攻撃力
* スキル配列
* ステート配列（付与順を保持）

### 3.4 ステートデータ

* ステートID
* ステート名
* スタック可否フラグ
* 残りターン数
* パッシブ効果フラグ
* 発動タイミング
* 効果内容の配列（適用順を保持）
* 上位排他ステートの配列
* 同位排他ステートの配列
* 下位排他ステートの配列

### 3.5 スキルデータ

* スキルID
* スキル名
* 攻撃対象配列
* ダメージ倍率
* 国力奪取倍率
* ユニット追加効果
* 国家追加効果

### 3.6 コマンドデータ

* コマンドID
* コマンド名
* 効果内容の配列（適用順を保持）

---

## 4. ゲーム進行構造

### 4.1 ゲーム進行の構成

* 全国家が1回ずつ行動する単位を1ラウンドとする
* ラウンド内での行動順は国家データが持つ手番の値の昇順で固定

1. ゲーム開始処理
3. ラウンド処理を規定ラウンド分繰り返し
2. ゲーム終了処理

#### 4.1.1 ゲーム開始処理

プレイヤーおよびNPCの国家情報をステージごとに設定された値で初期化する

### 4.2 ターンフェーズ構成

1. ターン開始処理

   * ターン開始時スキル／ステートの発動判定

2. 内政フェーズ

   * プレイヤー／NPCが内政コマンドを実行
   * ルール上必須処理は存在せず、
     「発動可能なスキル・ステートがあれば順次処理」する

3. 行動フェーズ

   * 戦闘を行うか否かの判定

4. ターン終了処理

   * ターン終了時スキル／ステート処理

---

## 5. スキル・ステート発動優先度

### 5.1 発動主体の優先順位

1. 現在のターンプレイヤー
2. 次のターンプレイヤー
3. 以下同様に順送り

### 5.2 同一国家内での優先順位

1. 国家ステート

   * 国家データが保持している **ステート配列の先頭から順に確認**
2. 前線ユニット

   * 前衛 → 中衛 → 後衛 の順
3. ベンチユニット

   * 国家が保持するユニット配列順

※条件を満たすものがあれば即時処理し、次を確認する

---

## 6. 内政コマンド

### 6.1 基本ルール

* 内政コマンドは内政フェーズ中に実行される
* 行動回数増加系効果の適用タイミングは
  **各スキル・ステートの個別定義に依存**する

【設計メモ】

* 「ターン中＋1」「次ターン＋1」などは共通ルール化しない

---

## 7. 戦闘処理

### 7.1 戦闘発生判定

* NPCは内政フェーズ終了時点の状態をもとに戦闘可否を判断する

【設計メモ】

* NPCの内政→行動決定フローをより厳密に定義する必要あり

### 7.2 ダメージ計算

* 最終ダメージは **0未満にならない（最小0保証）**

---

## 8. ゲーム終了処理

### 8.1 ゲームオーバー

* ターン終了時点で国力が0以下の国家は脱落する

### 8.2 勝利判定

* 規定ラウンド終了時点で国力が最大の国家が勝利
